<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Reversi DO – Index</title>
  <style>
    body { font-family: system-ui, sans-serif; line-height: 1.6; margin: 24px; }
    .rooms { display: grid; grid-template-columns: repeat(2, minmax(260px, 1fr)); gap: 16px; }
    .card { border:1px solid #ddd; border-radius:10px; padding:12px; }
    .title { font-weight:600; margin-bottom:8px; }
    .btns { display:flex; gap:8px; flex-wrap: wrap; }
    a.button { display:inline-block; padding:6px 10px; border:1px solid #ccc; border-radius:6px; text-decoration:none; }
    a.button:hover { background:#f7f7f7; }
    .hint { color:#666; font-size:12px; margin-top:6px; }
    .result { margin-top: 20px; padding:12px; border:1px solid #eee; border-radius:8px; background:#fafafa; }
    code { background:#f6f8fa; padding:2px 6px; border-radius:4px; }
  </style>
</head>
<body>
  <h1>Reversi – テストリンク</h1>
  <div class="hint">※ クリックすると <code>POST</code> + <code>x-www-form-urlencoded</code> で送ります（URLのクエリは表示用）。</div>

  <div class="rooms">
    <!-- Room 1 -->
    <div class="card">
      <div class="title">Room 1</div>
      <div class="btns">
        <a class="button" href="/join?id=1&seat=black">Join (black)</a>
        <a class="button" href="/join?id=1&seat=white">Join (white)</a>
        <a class="button" href="/join?id=1&seat=observer">Join (observer)</a>
        <a class="button" href="/reset?id=1">Reset</a>
      </div>
    </div>

    <!-- Room 2 -->
    <div class="card">
      <div class="title">Room 2</div>
      <div class="btns">
        <a class="button" href="/join?id=2&seat=black">Join (black)</a>
        <a class="button" href="/join?id=2&seat=white">Join (white)</a>
        <a class="button" href="/join?id=2&seat=observer">Join (observer)</a>
        <a class="button" href="/reset?id=2">Reset</a>
      </div>
    </div>

    <!-- Room 3 -->
    <div class="card">
      <div class="title">Room 3</div>
      <div class="btns">
        <a class="button" href="/join?id=3&seat=black">Join (black)</a>
        <a class="button" href="/join?id=3&seat=white">Join (white)</a>
        <a class="button" href="/join?id=3&seat=observer">Join (observer)</a>
        <a class="button" href="/reset?id=3">Reset</a>
      </div>
    </div>

    <!-- Room 4 -->
    <div class="card">
      <div class="title">Room 4</div>
      <div class="btns">
        <a class="button" href="/join?id=4&seat=black">Join (black)</a>
        <a class="button" href="/join?id=4&seat=white">Join (white)</a>
        <a class="button" href="/join?id=4&seat=observer">Join (observer)</a>
        <a class="button" href="/reset?id=4">Reset</a>
      </div>
    </div>
  </div>

  <div class="result">
    <strong>Last Response</strong><br/>
    room: <code id="out-room">-</code> /
    role: <code id="out-role">-</code> /
    step: <code id="out-step">-</code> /
    token: <code id="out-token">-</code>
  </div>

  <script>
    async function postForm(pathname, searchParams) {
      const res = await fetch(pathname, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: searchParams.toString()  // id=..&seat=.. / id=..
      });
      let json = null;
      try { json = await res.json(); } catch (_) {}
      return { ok: res.ok, status: res.status, json };
    }

    document.addEventListener("click", async (e) => {
      const a = e.target.closest("a.button");
      if (!a) return;
      e.preventDefault();

      // a.href を解析して、パスとクエリを POST に転用
      const url = new URL(a.getAttribute("href"), window.location.origin);
      const { ok, json } = await postForm(url.pathname, url.searchParams);

      // join のときだけ token/role/step が返る想定
      if (url.pathname === "/join" && ok && json) {
        document.getElementById("out-room").textContent  = url.searchParams.get("id") ?? "-";
        document.getElementById("out-role").textContent  = json.role ?? "-";
        document.getElementById("out-step").textContent  = json.step ?? "-";
        document.getElementById("out-token").textContent = json.token ?? "-";
      }
    });
  </script>
</body>
</html>